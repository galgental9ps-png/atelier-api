<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>AR – Echo der Gedanken</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      width: 100%;
      background: black;
      color: white;
      font-family: sans-serif;
    }
    #video {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }
    #art {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      max-width: 60%;
      border: 4px solid white;
      border-radius: 8px;
      display: none;
      z-index: 1;
    }
    #status {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
      z-index: 2;
    }
  </style>
</head>
<body>
  <video id="video" autoplay playsinline></video>
  <img id="art" src="echo_der_gedanken.jpg" alt="Echo der Gedanken">
  <div id="status">Suche Standort…</div>

  <script>
    const TARGET_LAT = 48.366184;
    const TARGET_LON = 10.867701;
    const MAX_DISTANCE = 50; // Meter, innerhalb dessen das Bild gezeigt wird

    const statusEl = document.getElementById('status');
    const artEl = document.getElementById('art');

    // Kamera einschalten
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        document.getElementById('video').srcObject = stream;
      } catch (err) {
        statusEl.textContent = "Kamera-Fehler: " + err.message;
      }
    }

    // Standort prüfen
    function checkPosition(pos) {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      const dist = distanceInMeters(lat, lon, TARGET_LAT, TARGET_LON);
      if (dist < MAX_DISTANCE) {
        statusEl.textContent = "Standort erkannt ✔ – Bild sichtbar";
        artEl.style.display = "block";
      } else {
        statusEl.textContent = "Zu weit entfernt (" + dist.toFixed(1) + "m)";
        artEl.style.display = "none";
      }
    }

    function errorPosition(err) {
      statusEl.textContent = "Standort-Fehler: " + err.message;
    }

    // Distanz-Berechnung Haversine
    function distanceInMeters(lat1, lon1, lat2, lon2) {
      const R = 6371e3; // Erd-Radius
      const toRad = x => x * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    // Start
    startCamera();
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(checkPosition, errorPosition, { enableHighAccuracy: true });
    } else {
      statusEl.textContent = "Geolocation nicht unterstützt.";
    }
  </script>
</body>
</html>
