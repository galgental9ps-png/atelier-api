<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Marker-AR (HIRO) – Fix gegen schwarzen Screen</title>

<!-- A-Frame + AR.js -->
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;color:#fff;font-family:system-ui,Inter,Roboto}
  #overlay{position:fixed;inset:0;display:grid;place-items:center;background:#000c;z-index:10;text-align:center;padding:16px}
  .btn{padding:12px 14px;border:0;border-radius:12px;font-weight:800;color:#fff;background:#0ea5e9;cursor:pointer}
  #status{position:fixed;left:50%;bottom:12px;transform:translateX(-50%);background:#000a;padding:8px 12px;border-radius:10px;z-index:5}
  #tips{position:fixed;top:8px;left:50%;transform:translateX(-50%);background:#000a;padding:6px 10px;border-radius:10px;z-index:5;font-size:12px}
  #link{position:fixed;top:8px;right:8px;z-index:6;background:#111;border:1px solid #333;padding:6px 10px;border-radius:8px}
  a-scene{position:fixed;inset:0}
</style>
</head>
<body>

<div id="tips">HTTPS nötig • Kamera erlauben • iOS: Einstellungen → Safari → „Bewegung & Orientierung“ aktivieren</div>
<div id="link"><a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/HIRO.jpg" target="_blank" style="color:#0ea5e9">HIRO-Marker öffnen</a></div>

<div id="overlay">
  <div>
    <h1>Marker-AR (HIRO)</h1>
    <p>Tippe auf „Kamera starten“. Richte die Kamera auf den <b>HIRO-Marker</b>.</p>
    <button id="start" class="btn">Kamera starten (Marker-AR)</button>
    <p id="err" style="opacity:.85;margin-top:10px"></p>
  </div>
</div>

<div id="status">Bereit…</div>
<div id="stage"></div>

<script>
const stage = document.getElementById('stage');
const overlay = document.getElementById('overlay');
const statusEl = document.getElementById('status');
const errEl = document.getElementById('err');

// Sanity-Checks
if(!(location.protocol==='https:' || location.hostname==='localhost' || location.hostname==='127.0.0.1')){
  errEl.textContent = '⚠️ Ohne HTTPS verweigern viele Browser die Kamera.';
}

document.getElementById('start').addEventListener('click', start);

async function start(){
  try{
    // 1) iOS/Android brauchen Nutzer-Gesture vor getUserMedia
    await navigator.mediaDevices.getUserMedia({ video:{ facingMode:'environment' } });
  }catch(e){
    errEl.textContent = 'Kamera-Fehler: ' + e.message;
    return;
  }

  // 2) Szene erst NACH dem Tap einsetzen (fix für iOS schwarzer Screen)
  stage.innerHTML = `
    <a-scene
      embedded
      renderer="antialias:true; alpha:true"
      vr-mode-ui="enabled:false"
      arjs="sourceType: webcam; facingMode: environment; detectionMode: mono; debugUIEnabled:false;">
      
      <!-- Marker + Inhalt -->
      <a-marker preset="hiro">
        <a-entity scale="2.8 2.8 2.8">
          <!-- großer, gut sichtbarer Würfel -->
          <a-box position="0 0.5 0"
                 width="1.6" height="1.6" depth="1.6"
                 material="color:#00ffff; opacity:0.95; shader:flat"
                 animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear"></a-box>

          <!-- Leuchtring als Kontrast -->
          <a-ring rotation="-90 0 0" radius-inner="0.9" radius-outer="1.1" position="0 0.01 0"
                  material="color:#00ffff; shader:flat; opacity:0.9"></a-ring>
        </a-entity>
      </a-marker>

      <!-- WICHTIG: für Marker-AR immer <a-entity camera>, nicht <a-camera> -->
      <a-entity camera></a-entity>
    </a-scene>
  `;

  overlay.style.display = 'none';
  statusEl.textContent = 'Starte Kamera… richte auf den HIRO-Marker.';
}
</script>
</body>
</html>
