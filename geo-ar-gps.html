<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Geo-AR â€“ Diagnose + Ultra sichtbar</title>

<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;color:#fff;
    font-family:-apple-system,system-ui,Segoe UI,Inter,Roboto,sans-serif}
  #overlay{position:fixed;inset:0;display:grid;place-items:center;
    background:linear-gradient(#000c,#000c);z-index:10;text-align:center;padding:16px}
  .btn{padding:12px 14px;border:0;border-radius:12px;font-weight:800;color:#fff;background:#0ea5e9;margin:0 6px}
  #status{position:fixed;left:50%;bottom:12px;transform:translateX(-50%);
    background:#000d;padding:10px 14px;border-radius:10px;z-index:5;white-space:nowrap;font-weight:700}
  /* HUD */
  #hud{position:fixed;top:88px;left:50%;transform:translateX(-50%);
    z-index:6;display:flex;flex-direction:column;align-items:center;gap:8px;pointer-events:none}
  #arrow{width:96px;height:96px;filter:drop-shadow(0 0 8px #00ffff);transition:transform 80ms linear}
  #dist{font-size:18px;font-weight:900;background:#000c;padding:8px 12px;border-radius:999px}
  #corner{position:fixed;top:12px;right:12px;z-index:7;display:flex;gap:8px;align-items:center}
  .chip{background:#000d;border:1px solid #1f2937;color:#fff;padding:8px 10px;border-radius:10px;font-size:12px}
  /* Diagnose Bar */
  #diag{position:fixed;top:0;left:0;right:0;z-index:8;display:flex;flex-wrap:wrap;gap:6px;padding:8px;
    background:#0b1220cc;border-bottom:1px solid #1f2937}
  .pill{font-size:12px;border-radius:999px;padding:6px 10px;border:1px solid #374151}
  .ok{color:#10b981;border-color:#10b981;}
  .warn{color:#f59e0b;border-color:#f59e0b;}
  .bad{color:#ef4444;border-color:#ef4444;}
</style>
</head>
<body>

<!-- Diagnose-Leiste -->
<div id="diag">
  <span id="httpsPill" class="pill">HTTPS: prÃ¼fenâ€¦</span>
  <span id="camPill" class="pill">Kamera: prÃ¼fenâ€¦</span>
  <span id="sensPill" class="pill">Sensor: prÃ¼fenâ€¦</span>
  <span id="geoPill" class="pill">Standort: prÃ¼fenâ€¦</span>
  <span id="headPill" class="pill">Heading: â€“</span>
  <span id="posPill" class="pill">Pos: â€“</span>
</div>

<div id="overlay">
  <div>
    <h1 style="margin:0 0 8px">Geo-AR starten</h1>
    <p style="opacity:.9;max-width:600px;margin:0 auto 14px">
      Erlaube <b>Kamera</b>. Bei iOS: <b>Bewegungssensor</b> zustimmen. FÃ¼r Geo-Spots zusÃ¤tzlich <b>Standort</b> erlauben.<br>
      <b>Tipp:</b> â€žHier testenâ€œ zeigt sofort einen <u>sehr auffÃ¤lligen Beacon</u> 1&nbsp;m vor dir (ohne Standort).
    </p>
    <button id="start" class="btn">Los gehtâ€™s (Geo-Spots)</button>
    <button id="spawnHere" class="btn" style="background:#10b981">Hier testen (1 m vor dir)</button>
    <button id="askGeo" class="btn" style="background:#f59e0b">Standort erlauben / neu holen</button>
    <div style="font-size:13px;opacity:.8;margin-top:10px">
      Hinweis: Standort funktioniert nur Ã¼ber <b>HTTPS</b> oder <b>localhost</b>. Kompass kurz kalibrieren (âˆž-Bewegung).
    </div>
  </div>
</div>

<div id="corner">
  <div class="chip">ðŸŽ¯ NÃ¤chster Spot: <span id="nearestName">â€“</span></div>
</div>

<div id="hud">
  <svg id="arrow" viewBox="0 0 100 100">
    <polygon points="50,5 80,55 60,55 60,95 40,95 40,55 20,55"
      fill="#00ffff" opacity="0.95"/>
  </svg>
  <div id="dist">Entfernung: â€“</div>
</div>

<div id="status">Bereitâ€¦</div>
<div id="mount"></div>

<script>
/*** Konfiguration ***/
const IMG_SRC = 'https://galgental9ps-png.github.io/atelier-api/echo_der_gedanken.jpg';
const TARGETS = [
  { name: 'Altstadt-Spot',             lat: 48.366184, lon: 10.867701 },
  { name: 'StettenstraÃŸe 7',           lat: 48.368905, lon: 10.898445 }, // 86150 Augsburg
  { name: 'Neuer Spot',                lat: 48.36630,  lon: 10.86781  },
  { name: 'GabelsbergerstraÃŸe 64',     lat: 48.33598,  lon: 10.86728  }  // 86199 Augsburg
];
const BIG_SCALE  = '34 25.5 1';   // riesig
const TEST_SCALE = '12 9 1';      // groÃŸ in 1 m

/*** UI-Refs ***/
const statusEl  = document.getElementById('status');
const mount     = document.getElementById('mount');
const overlay   = document.getElementById('overlay');
const arrowEl   = document.getElementById('arrow');
const distEl    = document.getElementById('dist');
const nearestNameEl = document.getElementById('nearestName');

const httpsPill = document.getElementById('httpsPill');
const camPill   = document.getElementById('camPill');
const sensPill  = document.getElementById('sensPill');
const geoPill   = document.getElementById('geoPill');
const headPill  = document.getElementById('headPill');
const posPill   = document.getElementById('posPill');

let sceneEl, localImgEl, started = false;
let deviceHeadingDeg = null;
let geoWatchId = null;

/*** Buttons ***/
document.getElementById('start').addEventListener('click', initGeo);
document.getElementById('spawnHere').addEventListener('click', spawnHere);
document.getElementById('askGeo').addEventListener('click', ensureGeoWatch);

// â€¦ dein restlicher Code (initGeo, spawnHere, ensureCameraAndMotion,
// ensureGeoWatch, buildScene, updateHudWithNearest, etc.) bleibt unverÃ¤ndert â€¦
</script>
</body>
</html>
