<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Geo-AR – Echo der Gedanken</title>

<!-- A-Frame + AR.js (GPS) -->
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;color:#fff}
  #overlay{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(#0009,#0009);z-index:10;text-align:center;padding:16px}
  .btn{padding:12px 14px;border:0;border-radius:12px;font-weight:700;color:#fff;background:#0ea5e9}
  #status{position:fixed;left:50%;bottom:14px;transform:translateX(-50%);background:#0009;padding:8px 12px;border-radius:8px;z-index:5}
</style>
</head>
<body>

<!-- Start-Overlay (Pflicht: User-Tap für Kamera/Kompass/Location) -->
<div id="overlay">
  <div>
    <h1 style="margin:0 0 6px">Geo-AR starten</h1>
    <p style="opacity:.85;max-width:520px;margin:0 0 12px">
      Erlaube Kamera, Bewegungssensor &amp; Standort. Gehe zur Position
      <b>48.366184, 10.867701</b>. Das Bild steht dort im Raum.
    </p>
    <button id="start" class="btn">Kamera &amp; Standort erlauben</button>
    <div style="font-size:13px;opacity:.75;margin-top:8px">Tipp: Draußen testen und Kompass kalibrieren (∞-Bewegung).</div>
  </div>
</div>

<!-- Geo-AR Szene -->
<a-scene
  id="scene"
  embedded
  style="display:none"
  vr-mode-ui="enabled:false"
  renderer="antialias:true;alpha:true"
  arjs="sourceType: webcam; videoTexture:true; debugUIEnabled:false; trackingMethod: best;">
  
  <!-- Dein Bild an fester GPS-Position (Breite/Höhe in Metern) -->
  <a-image
    id="art"
    src="https://galgental9ps-png.github.io/atelier-api/echo_der_gedanken.jpg"
    gps-entity-place="latitude: 48.366184; longitude: 10.867701;"
    look-at="[gps-camera]"
    scale="6 4.5 1"      <!-- ≈6 m breit, 4:3 -->
    rotation="0 0 0">
  </a-image>

  <!-- Kamera mit GPS/Kompass -->
  <a-camera gps-camera rotation-reader></a-camera>
</a-scene>

<div id="status">Bereit…</div>

<script>
const overlay = document.getElementById('overlay');
const scene   = document.getElementById('scene');
const status  = document.getElementById('status');

document.getElementById('start').addEventListener('click', async () => {
  // iOS: Bewegungssensor explizit erlauben (für Kompass/Ausrichtung)
  try {
    if (typeof DeviceMotionEvent !== 'undefined' &&
        typeof DeviceMotionEvent.requestPermission === 'function') {
      await DeviceMotionEvent.requestPermission().catch(()=>{});
    }
    if (typeof DeviceOrientationEvent !== 'undefined' &&
        typeof DeviceOrientationEvent.requestPermission === 'function') {
      await DeviceOrientationEvent.requestPermission().catch(()=>{});
    }
  } catch(e){ /* ignore */ }

  overlay.style.display = 'none';
  scene.style.display   = 'block';

  // Standort anstoßen (damit iOS sofort fragt)
  if ('geolocation' in navigator) {
    navigator.geolocation.getCurrentPosition(
      pos => status.textContent = `GPS aktiv (±${Math.round(pos.coords.accuracy)} m)`,
      err => status.textContent = 'Standort-Fehler: ' + err.message,
      { enableHighAccuracy:true, timeout:10000, maximumAge:0 }
    );
  } else {
    status.textContent = 'Geolocation wird nicht unterstützt.';
  }
});
</script>
</body>
</html>
