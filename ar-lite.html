<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Atelier Schwarzenberger – AR Galerie (Quick Look & Scene Viewer)</title>
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b0f14" />
  <style>
    /* ===== Design Tokens ===== */
    :root{
      color-scheme: dark;
      --bg1:#0b0f14;
      --bg2:#111a2b;
      --c1:#6ee7ff;  /* Cyan */
      --c2:#a78bfa;  /* Lila */
      --text:#e8eef7;
      --muted:#b4c0d6;
      --glass: rgba(255,255,255,.08);
      --glass-stroke: rgba(255,255,255,.16);
      --glass-weak: rgba(255,255,255,.06);
      --radius:16px;
      --blur:14px;
      --shadow: 0 12px 32px rgba(0,0,0,.45);
      --border:#1e2635;
    }

    /* ===== Base / Background ===== */
    html,body { margin:0; height:100% }
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Noto Sans", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 80% -10%, rgba(110,231,255,.15), transparent 55%),
        radial-gradient(1000px 600px at -10% 110%, rgba(167,139,250,.18), transparent 60%),
        linear-gradient(180deg, var(--bg2) 0%, var(--bg1) 70%);
      -webkit-tap-highlight-color: transparent;
    }
    .wrap{ min-height:100%; display:grid; grid-template-rows:auto 1fr auto; }

    /* ===== Header (Glass AppBar) ===== */
    header{
      position: sticky; top:0; z-index:10;
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      background: rgba(8,12,20,.45);
      border-bottom: 1px solid rgba(255,255,255,.07);
    }
    .bar{
      max-width:1100px; margin:0 auto;
      padding:10px clamp(12px,3vw,22px);
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      display:flex; align-items:center; gap:12px; text-decoration:none; color:inherit;
    }
    .logo img{
      width:40px; height:40px; object-fit:contain; border-radius:10px;
      filter: drop-shadow(0 5px 14px rgba(0,0,0,.35));
    }
    .brand{ display:flex; flex-direction:column; line-height:1.1 }
    .brand b{ letter-spacing:.2px }
    .brand small{ color:var(--muted); opacity:.95 }

    /* ===== Main ===== */
    main{ max-width:1100px; margin: clamp(14px,3.5vw,28px) auto; padding: 0 clamp(12px,3vw,22px); display:grid; gap:16px; }
    .hero{
      border:1px solid var(--glass-stroke);
      background: var(--glass);
      backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur));
      border-radius: var(--radius);
      padding: clamp(14px,3vw,22px);
      box-shadow: var(--shadow);
    }
    .headline{
      margin:0 0 6px;
      font-size: clamp(20px,3.5vw,34px);
      font-weight:800;
      background: linear-gradient(90deg, #fff 0%, #dff6ff 55%, #ffffff 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      letter-spacing:.2px;
    }
    .note{ color:var(--muted); font-size:.96rem }

    /* ===== Cards / Grid ===== */
    .row{ display:grid; gap:12px; grid-template-columns:1fr }
    @media (min-width:900px){ .row{ grid-template-columns:1fr 1fr } }

    .card{
      background: var(--glass);
      border: 1px solid var(--glass-stroke);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
    }
    .center{ text-align:center }

    .picker{ display:flex; gap:10px; justify-content:center; align-items:center; margin:12px 0; flex-wrap:wrap }
    label{ color:var(--muted) }
    select{
      background: var(--glass-weak); color:#fff; border:1px solid var(--glass-stroke);
      border-radius:12px; padding:10px 12px; backdrop-filter: blur(10px);
    }

    /* ===== Buttons (Glass) ===== */
    .btn{
      display:inline-flex; align-items:center; gap:.6rem;
      padding:12px 16px; border-radius:12px; font-weight:800; text-decoration:none;
      background: linear-gradient(180deg, rgba(110,231,255,.92), rgba(110,231,255,.72));
      color:#071018; border:1px solid rgba(110,231,255,.95);
      box-shadow: 0 8px 22px rgba(110,231,255,.25);
      transition: transform .05s ease, filter .2s ease, opacity .2s ease;
    }
    .btn:hover{ filter:saturate(1.1) brightness(1.03) }
    .btn:active{ transform: translateY(1px) scale(.995) }
    .btn.secondary{
      background: rgba(255,255,255,.06);
      color: var(--text);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:none;
    }
    .disabled{ opacity:.5; pointer-events:none }

    /* ===== model-viewer Frame ===== */
    model-viewer{
      width:100%; height:70vh; background: radial-gradient(1200px 600px at 60% 0%, rgba(110,231,255,.06), transparent 55%), #000;
      border-radius: var(--radius); border:1px solid var(--border);
    }

    /* AR Helper */
    .ar-poster{ width:1px; height:1px; opacity:0; pointer-events:none }

    /* Footer */
    footer{ color:var(--muted); padding:18px clamp(12px,3vw,22px) 28px }
    .foot-wrap{
      max-width:1100px; margin:0 auto;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
    }
    .chip{
      padding:6px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
    }
  </style>

  <!-- model-viewer -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <div class="wrap">
    <!-- ===== Header mit Logo ===== -->
    <header>
      <div class="bar">
        <a class="logo" href="#">
          <!-- 🔁 Pfad zum Logo anpassen -->
        <img src="./circling_flow.jpg" alt="Atelier Schwarzenberger – Echo der Gedanken" />
          <span class="brand">
            <b>;;;;;;;;;Atelier&nbsp;Schwarzenberger</b>
            <small>AR Galerie  </small>
          </span>
        </a>
      </div>
    </header>

    <!-- ===== Hero / Intro ===== -->
    <main>
      <section class="hero">
        <h1 class="headline">Kunst in Ihrer Umgebung – als AR-Erlebnis</h1>
        <p class="note">Wähle  ein Gemälde, starte Quick Look (iOS) oder Scene Viewer (Android) und platzieren Sie das Werk im Raum.
          Die Vorschau unten zeigt das 3D-Modell direkt im Browser.</p>
      </section>

      <!-- ===== Asset Picker ===== -->
      <section class="card">
        <h2 class="center">Gemälde wählen</h2>
        <div class="picker">
          <label for="assetSelect">Motiv:</label>
          <select id="assetSelect" aria-label="AR-Motiv wählen">
            <option disabled selected>Lade Motive…</option>
          </select>
        </div>
        <p id="status" class="note center"></p>
      </section>

      <!-- ===== AR Buttons ===== -->
      <div class="row">
        <section class="card center">
          <h2>iOS (Quick Look)</h2>
          <!-- WICHTIG: <a rel="ar"> braucht ein <img>-Kind -->
          <a id="iosArLink" class="btn disabled" rel="ar" href="#">
            📱 In AR ansehen (iOS)
            <img class="ar-poster" alt=""
                 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAoMBg6E9yjcAAAAASUVORK5CYII=" />
          </a>
          <p class="note">Öffne die Seite in Safari. Tippe den Button – Quick Look startet.</p>
        </section>

        <section class="card center">
          <h2>Android (Scene Viewer)</h2>
          <a id="androidArLink" class="btn secondary disabled" href="#" target="_blank" rel="noopener">
            🤖 In AR ansehen (Android)
          </a>
          <p class="note">Öffne die Seite in Chrome. Tippe den Button – Scene Viewer startet.</p>
        </section>
      </div>

      <!-- ===== Browser Vorschau ===== -->
      <section class="card">
        <h2>Vorschau im Browser (optional)</h2>
        <model-viewer
          id="mv"
          ar
          ar-modes="scene-viewer quick-look webxr"
          ar-scale="fixed"
          camera-controls
          exposure="1.0"
          shadow-intensity="0">
        </model-viewer>
        <p class="note">Tipp: Für die zuverlässigste AR-Erfahrung nutze die Buttons oben.</p>
      </section>
    </main>

    <footer>
      <div class="foot-wrap">
        <div class="chip">© <span id="y"></span> Atelier Schwarzenberger</div>
      </div>
    </footer>
  </div>

  <!-- ===== Logic unverändert, nur leicht aufgeräumt ===== -->
  <script>
    // Jahr im Footer
    document.getElementById('y').textContent = new Date().getFullYear();

    // ====== KONFIG (dein Repo) ======
    const OWNER  = "galgental9ps-png";
    const REPO   = "atelier-api";
    const PATH   = "";       // Root. Falls Unterordner, z.B. "ar/"
    const BRANCH = "main";

    // GitHub API & RAW-Basis
    const API = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}?ref=${BRANCH}`;
    const RAW = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${PATH}`;

    const select = document.getElementById('assetSelect');
    const status = document.getElementById('status');
    const iosArLink = document.getElementById('iosArLink');
    const androidArLink = document.getElementById('androidArLink');
    const mv = document.getElementById('mv');

    const isUSDZ = n => /\.usdz$/i.test(n);
    const isGLB  = n => /\.glb$/i.test(n);
    const stem   = n => n.replace(/\.(usdz|glb|gltf)$/i, "");

    function buildAndroidIntent(glbUrl, title) {
      const u = new URL("https://arvr.google.com/scene-viewer/1.0");
      u.searchParams.set("file", glbUrl);
      u.searchParams.set("mode", "ar_preferred");
      u.searchParams.set("title", title || "AR Poster");
      return u.toString();
    }

    function groupAssets(files) {
      const usdz = new Map(), glb = new Map();
      for (const f of files) {
        if (f.type !== "file") continue;
        if (isUSDZ(f.name)) usdz.set(stem(f.name), f.name);
        if (isGLB(f.name))  glb.set(stem(f.name),  f.name);
      }
      const all = new Set([...usdz.keys(), ...glb.keys()]);
      return [...all].map(s => ({ name: s, usdz: usdz.get(s) || null, glb: glb.get(s) || null }))
                     .sort((a,b) => a.name.localeCompare(b.name, 'de'));
    }

    function populateSelect(pairs) {
      select.innerHTML = "";
      let first = null;
      for (const p of pairs) {
        if (!p.usdz && !p.glb) continue;
        const opt = document.createElement("option");
        opt.value = p.name;
        opt.textContent = p.name + (!p.usdz || !p.glb ? ` ${!p.usdz ? "(ohne USDZ)" : ""}${!p.glb ? "(ohne GLB)" : ""}` : "");
        select.appendChild(opt);
        if (!first) first = p.name;
      }
      if (!first) throw new Error("Keine passenden Dateien gefunden (.usdz/.glb).");
      return first;
    }

    function updateAsset(name, pairs) {
      const p = pairs.find(x => x.name === name);
      if (!p) return;

      const usdzUrl = p.usdz ? `${RAW}${p.usdz}` : null;
      const glbUrl  = p.glb  ? `${RAW}${p.glb}`  : null;

      // iOS
      if (usdzUrl) { iosArLink.href = usdzUrl; iosArLink.classList.remove("disabled"); }
      else         { iosArLink.href = "#";      iosArLink.classList.add("disabled");  }

      // Android
      if (glbUrl)  { androidArLink.href = buildAndroidIntent(glbUrl, name); androidArLink.classList.remove("disabled"); }
      else         { androidArLink.href = "#"; androidArLink.classList.add("disabled"); }

      // Vorschau
      if (usdzUrl) mv.setAttribute("ios-src", usdzUrl); else mv.removeAttribute("ios-src");
      if (glbUrl)  mv.setAttribute("src", glbUrl);      else mv.removeAttribute("src");

      // Hinweis
      if (!p.usdz || !p.glb) {
        status.innerHTML = `<span style="color:#fbbf24">Hinweis:</span> Für „${name}“ ${
          !p.usdz && !p.glb ? "fehlen USDZ <u>und</u> GLB" :
          !p.usdz ? "fehlt USDZ (iOS Quick Look)" : "fehlt GLB (Android Scene Viewer)"
        }.`;
      } else {
        status.textContent = "";
      }
    }

    async function init() {
      status.textContent = "Lade Dateien aus GitHub…";
      try {
        const res = await fetch(API, { headers: { "Accept": "application/vnd.github+json" }});
        if (!res.ok) throw new Error(`GitHub API Fehler: ${res.status}`);
        const files = await res.json();

        const pairs = groupAssets(files);

        if (!Array.isArray(files) || !files.length) {
          console.warn("GitHub API leer/blocked – Fallback aktiv.");
          const fallback = [{ name: "circling_flow", usdz: "circling_flow.usdz", glb: "circling_flow.glb" }];
          populateSelect(fallback);
          updateAsset("circling_flow", fallback);
          status.innerHTML = `<span style="color:#fbbf24">Hinweis:</span> Fallback aktiv – nur „circling_flow“ sichtbar.`;
          return;
        }

        const first = populateSelect(pairs);
        updateAsset(first, pairs);
        select.addEventListener("change", e => updateAsset(e.target.value, pairs));
        status.textContent = "";
      } catch (err) {
        console.error(err);
        const fallback = [{ name: "circling_flow", usdz: "circling_flow.usdz", glb: "circling_flow.glb" }];
        select.innerHTML = `<option value="circling_flow">circling_flow</option>`;
        updateAsset("circling_flow", fallback);
        status.innerHTML = `<span style="color:#f87171">Fehler:</span> ${String(err.message || err)} – Fallback nur „circling_flow“.`;
      }
    }

    init();
  </script>
</body>
</html>
